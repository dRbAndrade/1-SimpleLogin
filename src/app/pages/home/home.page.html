<ion-menu (ionWillClose)="toggleMenuIcon()" (ionWillOpen)="toggleMenuIcon()" contentId="main-content">
  <ion-content class="ion-padding">
    <ng-template #moduleTemplate let-modules="modules">
      <ion-accordion-group>
        <ion-accordion class="accordion" *ngFor="let module of modules">
          <div [routerLink]="module.url ? ['/'+module.url] : []" class="menu accordion-header" slot="header">
            <div>
              <div *ngIf="module.icon" class="module-icon" style="--icon-url: url('../../../assets/icon/{{module.icon}}.svg');"></div>
              {{module.title | uppercase}}
            </div>
            <ion-icon *ngIf="module.submodules?.length" name="chevron-up-outline"></ion-icon>
          </div>
          <div slot="content">
              <ng-container *ngTemplateOutlet="moduleTemplate; context: {modules:module.submodules}"></ng-container>
          </div>
        </ion-accordion>
      </ion-accordion-group>
    </ng-template>
    <ng-container *ngTemplateOutlet="moduleTemplate; context: {modules:modules}" slot="content"></ng-container>
  </ion-content>
</ion-menu>
<ion-header>
  <ion-toolbar class="toolbar">
    <ion-buttons slot="start">
      <ion-icon class="circular" id="profile-popover-trigger" name="person-circle"></ion-icon>
    </ion-buttons>
    <ion-buttons slot="end" class="header-navigation">
      <ion-img id="suant-popover-trigger" class="header-image" src="../../../assets/images/sunat.png"></ion-img>
      <ion-icon id="notifications-popover-trigger" name="notifications-outline"></ion-icon>
      <div id="help-popover-trigger" class="notifications-container">
        <ion-icon class="circular" name="help-circle-outline"></ion-icon>
        <span>{{helpDocs.length}}</span>
      </div>
      <ion-img class="header-image" routerLink="/incidents" src="../../../assets/icon/incidents-icon.png"></ion-img>
      <ion-icon id="apps-popover-trigger" name="apps"></ion-icon>
      <ion-menu-toggle>
        <custom-menu-button class="header-image" [status]="menuStatus"></custom-menu-button>
      </ion-menu-toggle>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content id="main-content">
  <div class="content">
    <div class="status-container">
      <div class="status-controls">
        <ion-button id="download-popover-trigger" class="home-button">Descargar Informe</ion-button>
        <ion-button class="home-button" id="date-picker">
          <div>
            <ion-icon name="calendar-clear-outline"></ion-icon>
            {{displayedDate}}
          </div>
        </ion-button>
        <ion-picker
          trigger="date-picker"
          [columns]="pickerColumns"
          [buttons]="pickerButtons"
          mode="ios"
        ></ion-picker>
      </div>

      <ion-card>
        <ion-card-header mode="md">
          <ion-card-title>ESTATUS COMPROBANTES ELECTRÓNICOS</ion-card-title>
          <ion-card-subtitle> {{total}} comprobantes </ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <pie-chart [data]="statusData"></pie-chart>
        </ion-card-content>
      </ion-card>
      <ion-card>
        <ion-card-header mode="md">
          <ion-card-title>DOCUMENTOS RECHAZADOS</ion-card-title>
          <ion-card-subtitle>{{rejectedData.title}}</ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <ion-accordion-group>
            <ion-accordion *ngFor="let info of rejectedData.info">
              <div slot="header" class="accordion-header">
                <div>
                  <span class="square"></span>
                  <ion-label>{{info.ruc}} - {{info.issuerName}}</ion-label>
                </div>
                <ion-icon name="chevron-up-outline"></ion-icon>
              </div>
              <rejected-table
                slot="content"
                [data]="info.errors"
              ></rejected-table>
            </ion-accordion>
          </ion-accordion-group>
        </ion-card-content>
      </ion-card>
      <ion-card class="status-card">
        <ion-card-header mode="md">
          <ion-card-title>COMPROBANTES PROCESADOS</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <column-chart [chartData]="processedData"></column-chart>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
  <custom-footer></custom-footer>
</ion-content>

<ion-popover trigger="download-popover-trigger" mode="md" [dismissOnSelect]="true">
  <ng-template>
    <div class="popover-buttons ion-activatable" (click)="downloadReport(1)">
      <ion-ripple-effect></ion-ripple-effect>
      <ion-icon name="pie-chart-outline"></ion-icon>Estatus Comprobantes
    </div>
    <div class="popover-buttons ion-activatable" (click)="downloadReport(2)">
      <ion-ripple-effect></ion-ripple-effect>
      <ion-icon name="pie-chart-outline"></ion-icon>Comprobantes Procesados
    </div>
  </ng-template>
</ion-popover>

<ion-popover class="header-popover" trigger="suant-popover-trigger" mode="md" [dismissOnSelect]="true">
  <ng-template>
    <div class="popover-buttons centralized ion-activatable">
      <ion-ripple-effect></ion-ripple-effect>
      OSE/SUNAT
    </div>
  </ng-template>
</ion-popover>

<ion-popover class="header-popover" trigger="notifications-popover-trigger" mode="md" [dismissOnSelect]="true">
  <ng-template>
    <div class="popover-buttons centralized ion-activatable">
      <ion-ripple-effect></ion-ripple-effect>
      Notificaciones
    </div>
  </ng-template>
</ion-popover>

<ion-popover class="header-popover" trigger="help-popover-trigger" mode="md" [dismissOnSelect]="true">
  <ng-template>
    <div class="popover-buttons ion-activatable" *ngFor="let doc of helpDocs">
      <ion-ripple-effect></ion-ripple-effect>
      <div class="download-icon">
        <img src="../../../assets/icon/download.svg" [alt]="'Download ' + doc.title">
      </div>
      <a [href]="doc.url" target="_blank">
        <p>{{doc.title}}</p>
        <ion-note>Actualizado al {{doc.updatedDate}}</ion-note>
      </a>
    </div>
    <div class="popover-buttons centralized">
      Documentación
    </div>
  </ng-template>
</ion-popover>

<ion-popover class="header-popover" trigger="apps-popover-trigger" mode="md" [dismissOnSelect]="true">
  <ng-template>
    <div class="apps-popover">
      <div class="apps-title">Mis Módulos</div>
      <div class="apps-button ion-activatable">
        <ion-ripple-effect></ion-ripple-effect>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-upload-cloud icon-dual"><polyline points="16 16 12 12 8 16"></polyline><line x1="12" y1="12" x2="12" y2="21"></line><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"></path><polyline points="16 16 12 12 8 16"></polyline></svg>
        <b>EMISIÓN</b>
        <i>Gestionar mis Ventas</i>
      </div>
      <div class="apps-button ion-activatable">
        <ion-ripple-effect></ion-ripple-effect>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download-cloud icon-dual"><polyline points="8 17 12 21 16 17"></polyline><line x1="12" y1="12" x2="12" y2="21"></line><path d="M20.88 18.09A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.29"></path></svg>
        <b>RECEPCIÓN</b>
        <i>Gestionar mis Compras</i>
      </div>
    </div>
  </ng-template>
</ion-popover>

<ion-popover class="header-popover" trigger="profile-popover-trigger" mode="md" [dismissOnSelect]="true">
  <ng-template>
    <div class="profile">
      <div class="popover-buttons">Bienvenido</div>
      <div class="popover-buttons ion-activatable">
        <ion-ripple-effect></ion-ripple-effect>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-lock icon-dual icon-xs me-1"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
        Cambiar clave
      </div>
      <div class="popover-buttons ion-activatable">
        <ion-ripple-effect></ion-ripple-effect>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-log-out icon-dual icon-xs me-1"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
        Salir
      </div>
    </div>
  </ng-template>
</ion-popover>